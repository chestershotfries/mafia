<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mafia Randomizer</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="container">
    <div class="header-row">
      <h1>Mafia Game Randomizer</h1>
      <a href="./stats.html" class="btn btn-secondary">Stats</a>
    </div>

    <!-- Panel 1: Name Entry & Randomization -->
    <section id="panel-randomize" class="panel active">
      <h2>Enter Players</h2>
      <textarea id="names-input" placeholder="Enter 13-15 names, one per line or comma-separated"
                rows="8"></textarea>
      <p id="name-counter" class="counter">0/15 names</p>
      <div class="button-row">
        <button id="btn-randomize" class="btn btn-primary">Randomize</button>
        <button id="btn-manual" class="btn btn-secondary">Manual Setup</button>
        <button id="btn-retro" class="btn btn-secondary">Log Past Game</button>
        <input id="dice-max" type="number" class="dice-input" value="20" min="2">
        <button id="btn-dice" class="btn btn-secondary btn-sm">Roll</button>
        <span id="dice-result" class="d100-result"></span>
      </div>

      <div id="assignments-display" class="hidden">
        <h3>Assignments <span id="roll-count" class="roll-count"></span></h3>
        <ol id="assignments-list" class="assignments-list"></ol>
        <h3>RNG Formals</h3>
        <div id="formals-schedule" class="formals-grid"></div>
        <div class="button-row">
          <button id="btn-reroll" class="btn btn-secondary">Re-randomize</button>
          <button id="btn-accept" class="btn btn-primary">Accept &amp; Play</button>
        </div>
      </div>

      <div id="manual-setup" class="hidden">
        <h3>Assign Roles</h3>
        <p class="hint">Click role buttons to cycle: Town → Mafia → Cop → Medic → Vigi. Click names to edit.</p>
        <p id="mafia-counter" class="counter">0/3 Mafia · 0/1 Cop · 0/1 Medic · 0/1 Vigi</p>
        <div id="manual-player-list" class="manual-player-grid"></div>
        <div class="button-row">
          <button id="btn-manual-cancel" class="btn btn-secondary">Cancel</button>
          <button id="btn-manual-accept" class="btn btn-primary" disabled>Accept &amp; Play</button>
        </div>
      </div>

      <div id="retro-form" class="hidden">
        <h3>Log Past Game</h3>
        <p class="hint">Click role buttons to cycle: Town → Mafia → Cop → Medic → Vigi. Click names to edit.</p>
        <p id="retro-mafia-counter" class="counter">0/3 Mafia · 0/1 Cop · 0/1 Medic · 0/1 Vigi</p>
        <div id="retro-player-list" class="manual-player-grid"></div>

        <div class="form-group">
          <label class="form-label">Winner:</label>
          <div class="radio-group winner-group">
            <label><input type="radio" name="retro-winner" value="Mafia"> Mafia Win</label>
            <label><input type="radio" name="retro-winner" value="Town"> Town Win</label>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Night 0 Kills:</label>
          <div id="retro-n0-checks" class="checkbox-group"></div>
        </div>

        <p id="retro-rated-preview" class="counter"></p>

        <div class="button-row">
          <button id="btn-retro-cancel" class="btn btn-secondary">Cancel</button>
          <button id="btn-retro-submit" class="btn btn-primary" disabled>Submit Game</button>
        </div>
      </div>
    </section>

    <!-- Panel 2: Game Panel -->
    <section id="panel-game" class="panel hidden">
      <h2>Game Panel</h2>

      <div class="discord-block">
        <div class="discord-header">
          <span>Role Reveal</span>
          <button class="btn-copy" data-target="role-reveal-pre">Copy</button>
        </div>
        <pre id="role-reveal-pre" class="discord-pre"></pre>
      </div>

      <div id="nights-container"></div>

      <div id="night-buttons" class="night-buttons"></div>
      <div id="win-indicator" class="win-indicator hidden"></div>
      <div class="button-row">
        <button id="btn-new-game-2" class="btn btn-secondary">New Game</button>
        <button id="btn-continue-record" class="btn btn-primary">Continue to Record</button>
      </div>
    </section>

    <!-- Panel 3: Record Results -->
    <section id="panel-record" class="panel hidden">
      <h2>Record Results</h2>
      <div id="locked-assignments">
        <h3>Game Assignments</h3>
        <p class="hint">Click a name to edit it</p>
        <ol id="locked-list" class="assignments-list"></ol>
        <h3>RNG Formals</h3>
        <div id="locked-formals" class="formals-grid"></div>
      </div>

      <div class="form-group">
        <label class="form-label">Winner:</label>
        <div class="radio-group winner-group">
          <label><input type="radio" name="winner" value="Mafia"> Mafia Win</label>
          <label><input type="radio" name="winner" value="Town"> Town Win</label>
        </div>
      </div>

      <div id="night0-section" class="form-group">
        <label class="form-label">Night 0 Kills:</label>
        <div id="night0-checks" class="checkbox-group"></div>
      </div>

      <p id="rated-preview" class="counter"></p>

      <div class="button-row">
        <button id="btn-new-game-3" class="btn btn-secondary">New Game</button>
        <button id="btn-back" class="btn btn-secondary">Back</button>
        <button id="btn-submit" class="btn btn-primary" disabled>Submit Results</button>
      </div>
    </section>

    <!-- Panel 4: Results & Verification -->
    <section id="panel-results" class="panel hidden">
      <h2>Rating Changes</h2>
      <table id="results-table" class="results-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Alignment</th>
            <th>Result</th>
            <th>Old Rating</th>
            <th>New Rating</th>
            <th>Change</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="roles-summary" class="roles-summary"></div>

      <div id="excluded-summary" class="excluded-summary"></div>

      <div class="button-row">
        <button id="btn-new-game" class="btn btn-primary">New Game</button>
      </div>
    </section>

    <!-- Persistent: Last Game -->
    <section id="last-game-section" class="last-game">
      <h2>Last Recorded Game</h2>
      <div id="last-game-content">Loading...</div>
      <button id="btn-undo-last" class="btn btn-secondary hidden">Undo Last Game</button>
    </section>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
